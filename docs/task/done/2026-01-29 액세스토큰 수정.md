# 에이전트 작업 절차

1. 아래 `## 개발자 요구사항` 섹션을 바탕으로 코드 베이스를 검토하고 작업을 준비한다.
2. 만약 마지막 섹션이 `## 개발자 요구사항 수정` 또는 `## 개발자 검토답변` 등 개발자의 섹션이라면 중간을 건너뛰고 해당 부분부터 작업하도록 한다.
3. 개발자의 의사결정이 필요한 내용이 있다면 문의할 내용을 이 파일의 마지막에 `## 에이전트 검토요청`으로 섹션을 추가하고 작업을 종료한다.
4. 작업을 완료한 경우 내용 이 파일의 마지막에 `## 에이전트 작업수행내용:{yyyy-MM-dd HH : MM}` 섹션을 추가하고 작업한 상세 내용을 작성한다.
5. 그밖의 일반적인 작업지침은 [ai_agent_guide.md](/docs/guide/ai_agent_guide.md) 을 확인 후 작업한다.

## 개발자 요구사항

- docs/guide/api_design_guide.md 을 보면 JWT를 해더에 담아서 보내게 되어있다.
- 하지만 실제로는 쿠키를 검사한다.
- 앞으로는 먼저 쿠키를 검사한후 없다면 해더를 검사하는 방식으로 개선하고자 한다.
- 이방식은 API 테스트를 쉽게해줄 수 있다.
- 또한 헤더로 토큰을 보낼때는 리프레쉬 토큰을 포함하지 않는다.
- 먼저 api 가이드 문서를 수정하고 그에 따라서 현재 구현체를 확인후 그와 일치하도록 수정한다.
- 관련한 테스트도 확인후 추가. 수정한다.
- src/main/java/maskun/quietchatter/security 에 관련 구현체가 있으니 확인한다.

## 에이전트 작업수행내용:2026-01-29 10:40

- **API 디자인 가이드 수정 (`docs/guide/api_design_guide.md`)**:
    - 인증 방식을 Cookie 우선, Header 차순위로 변경하여 명시했습니다.
    - Refresh Token은 Cookie로만 제한함을 명시했습니다.
- **코드 수정 (`AuthTokenService.java`)**:
    - `extractAccessToken` 메서드를 수정하여 `access_token` 쿠키를 먼저 확인하고, 없을 경우 `Authorization` 헤더에서 Bearer 토큰을 추출하도록 로직을 개선했습니다.
    - `extractBearerToken` 헬퍼 메서드를 추가했습니다.
- **테스트 추가 (`AuthTokenServiceTest.java`)**:
    - Header를 통한 토큰 추출 테스트 (`extractAccessToken_should_retrieve_from_header_when_cookie_missing`) 추가.
    - Cookie 우선 순위 확인 테스트 (`extractAccessToken_should_prioritize_cookie_over_header`) 추가.
    - 테스트 실행 결과 모든 테스트가 통과함을 확인했습니다.