# 에이전트 작업 절차

1. 아래 `## 개발자 요구사항` 섹션을 바탕으로 코드 베이스를 검토하고 작업을 준비한다.
2. 만약 마지막 섹션이 `## 개발자 요구사항 수정` 또는 `## 개발자 검토답변` 등 개발자의 섹션이라면 중간을 건너뛰고 해당 부분부터 작업하도록 한다.
3. 개발자의 의사결정이 필요한 내용이 있다면 문의할 내용을 이 파일의 마지막에 `## 에이전트 검토요청`으로 섹션을 추가하고 작업을 종료한다.

## 에이전트 작업수행내용 : 2026-01-29 16:30

웹 요청 추적을 위한 MDC 필터 및 로깅 설정을 다음과 같이 완료하였습니다.

### 1. MDC 필터 구현 (`MdcFilter.java`)

- `OncePerRequestFilter`를 상속받아 구현하였습니다.
- 요청 진입 시 `UUID`를 생성하여 MDC에 `trace-id`로 저장합니다.
- `try-catch-finally` 블록을 사용하여 예외 발생 시 에러 로깅 후 재투척(re-throw)하며, `finally`에서 MDC를 명확히 비워(`clear`) 스레드 로컬 자원 오염을 방지합니다.
- 요청 정보(URI, IP, Principal)를 INFO 레벨로 로깅합니다.

### 2. 보안 필터 체인 등록 (`SecurityConfig.java`)

- `MdcFilter`를 시큐리티 필터 체인의 마지막(커스텀 필터들 이후)에 등록하였습니다.
- 이를 통해 `AuthFilter` 및 `AnonymousToGuestPromotionFilter`에 의해 확정된 사용자 정보(`Principal`)를 정확히 로깅할 수 있습니다.

### 3. 로깅 포맷 설정 (`logback-spring.xml`)

- `src/main/resources/logback-spring.xml` 파일을 생성하였습니다.
- 로그 패턴에 `[%X{trace-id:-not-assigned}]`를 추가하여, MDC에 값이 없는 내부 호출의 경우 `not-assigned`로 출력되도록 설정하였습니다.
- 스프링 부트 기본 설정을 유지하면서 콘솔 출력 패턴만 커스터마이징하였습니다.

### 4. 검증 완료

- `MdcFilterTest` 유닛 테스트를 통해 MDC 설정 및 해제 로직을 확인하였습니다.
- 기존 시큐리티 통합 테스트(`JwtAuthenticateTest` 등)를 실행하여 실제 로그에 `trace-id`가 포함되어 출력됨을 확인하였습니다.