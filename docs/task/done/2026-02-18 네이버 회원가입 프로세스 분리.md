# 에이전트 작업 절차

1. 아래 `## 개발자 요구사항` 섹션을 바탕으로 코드 베이스를 검토하고 작업을 준비한다.
2. 만약 마지막 섹션이 `## 개발자 요구사항 수정` 또는 `## 개발자 검토답변` 등 개발자의 섹션이라면 중간을 건너뛰고 해당 부분부터 작업하도록 한다.
3. 개발자의 의사결정이 필요한 내용이 있다면 문의할 내용을 이 파일의 마지막에 `## 에이전트 검토요청`으로 섹션을 추가하고 작업을 종료한다.
4. 작업을 완료한 경우 내용 이 파일의 마지막에 `## 에이전트 작업수행내용 : {yyyy-MM-dd HH : MM}` 섹션을 추가하고 작업한 상세 내용을 작성한다.
5. 그밖의 일반적인 작업지침은 [ai_agent_guide.md](/docs/guide/ai_agent_guide.md) 을 확인 후 작업한다.

## 개발자 요구사항

- 기존 네이버 로그인 시 자동 가입되던 로직을 제거하고, 로그인과 회원가입 프로세스를 분리한다.
- **로그인 API (`/v1/auth/login/naver`)**: 
    - 미가입 사용자일 경우 `200 OK`와 함께 `isRegistered: false`, `registerToken`, `tempNickname`을 반환한다.
    - 가입된 사용자일 경우 `200 OK`와 함께 `isRegistered: true`를 반환하고, 기존대로 인증 쿠키를 발급한다.
- **회원가입 API (`/v1/auth/signup/naver`)**:
    - 신규 추가한다.
    - `registerToken`과 `nickname`을 입력받아 검증 후 회원을 생성한다.
    - 성공 시 인증 쿠키를 발급한다.
- **보안**: 회원가입 시 `providerId` 위변조를 막기 위해 `Register Token` (JWT, 유효기간 2시간)을 발급하여 검증한다.

## 에이전트 작업수행내용 : 2026-02-18 21:30

### 1. 보안 토큰 서비스 확장 (`AuthTokenService`)
- 회원가입용 임시 토큰(`Register Token`) 발급 및 검증 로직을 추가했습니다.
- 유효기간은 2시간으로 설정하였으며, 클레임에 `purpose: register`를 포함하여 용도를 제한했습니다.

### 2. 서비스 계층 분리 (`AuthMemberService`)
- 기존 `loginWithNaver` 메서드에서 회원 생성 로직을 제거하고, 네이버 프로필 정보만 반환하도록 수정했습니다.
- 회원 생성을 전담하는 `signupWithNaver` 메서드를 추가했습니다.
- `getByNaverId` 메서드에서 조회된 회원을 Redis 캐시에 저장하도록 보완했습니다.

### 3. API 구현 (`AuthLoginApi`, `AuthSignupApi`)
- `AuthLoginApi`: 로그인 결과에 따라 `NaverLoginResponse` (가입 여부, 토큰 등 포함)를 반환하도록 수정했습니다.
- `AuthSignupApi`: `/v1/auth/signup/naver` 엔드포인트를 신설하여 `SignupRequest`를 처리하도록 구현했습니다.

### 4. 테스트 및 문서화
- `AuthMemberServiceTest`: 변경된 로직에 맞춰 단위 테스트를 수정하고 추가했습니다.
- `AuthLoginApiTest`, `AuthSignupApiTest`: `RestDocs` 기반의 테스트를 작성하여 API 문서(`openapi3.json`)에 반영했습니다.
