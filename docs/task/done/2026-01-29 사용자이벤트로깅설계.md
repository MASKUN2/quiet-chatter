# 에이전트 작업 절차

1. 아래 `## 개발자 요구사항` 섹션을 바탕으로 코드 베이스를 검토하고 작업을 준비한다.
2. 만약 마지막 섹션이 `## 개발자 요구사항 수정` 또는 `## 개발자 검토답변` 등 개발자의 섹션이라면 중간을 건너뛰고 해당 부분부터 작업하도록 한다.
3. 개발자의 의사결정이 필요한 내용이 있다면 문의할 내용을 이 파일의 마지막에 `## 에이전트 검토요청`으로 섹션을 추가하고 작업을 종료한다.
4. 작업을 완료한 경우 내용 이 파일의 마지막에 `## 에이전트 작업수행내용 : {yyyy-MM-dd HH : MM}` 섹션을 추가하고 작업한 상세 내용을 작성한다.
5. 그밖의 일반적인 작업지침은 [ai_agent_guide.md](/docs/guide/ai_agent_guide.md) 을 확인 후 작업한다.

## 개발자 요구사항

- 본 작업은 따로 요청이 있기 전까지 코드 수정을 하지 않는 작업이다.

- 본 프로젝트에 사용자 이벤트를 수집하려고한다.

- 개발자가 찾아보니 slf4j + MDC + filter를 사용해서 요청과 응답을 그대로 로깅하는 방법이 있고, aop를 사용하는 방법도 있다.

- 프로젝트의 규모와 향수 유지보수를 고려했을때 어떤 방식이 좋을지 분석하고 아래에 답변한다.

## 에이전트 작업수행내용 : 2026-01-29 14:30

프로젝트의 **헥사고날 아키텍처** 특성과 **유지보수성**, 그리고 **클린 코드 원칙**(메서드 당 책임 제한 등)을 고려하여 다음과 같이 분석 및 제안을 드립니다.

### 1. 방식별 상세 분석

| 항목 | Filter + MDC (요청/응답 로깅) | AOP (비즈니스 이벤트 로깅) |

| :--- | :--- | :--- |

| **주요 목적** | HTTP 레벨의 기술적 감사 (Audit) | 사용자의 의도가 담긴 비즈니스 행위 수집 |

| **장점** | - 모든 요청에 대해 누락 없는 로깅 가능 <br> - 인증 실패 등 Controller 도달 전 오류 포착 가능 <br> - MDC를 통해 전체 요청 흐름 추적 용이 | - 필요한 행위만
선별적으로 로깅하여 노이즈 감소 <br> - 메서드 인자(객체)에 직접 접근하여 상세 정보 추출 용이 <br> - 비즈니스 의미(예: '톡 작성') 부여 가능 |

| **단점** | - Body 로깅 시 스트림 재생성 등 오버헤드 발생 <br> - 모든 요청(GET, Health Check 등) 로깅 시 데이터 과부하 <br> - 비즈니스 맥락 파악을 위해 JSON 파싱
필요 | - Filter 계층에서 발생하는 오류는 포착 불가 <br> - Pointcut 관리가 필요하며 비즈니스 로직과 별개로 관리 포인트 발생 |

| **유지보수성** | 인프라 계층(Adapter)에 위치하여 비즈니스 로직과 완전 분리됨 | 비즈니스 로직의 변화(메서드 시그니처 변경 등)에 영향을 받을 수 있음 |

### 2. 프로젝트 특성에 따른 검토 (Quiet Chatter)

- **헥사고날 아키텍처**: 아키텍처 관점에서 Filter는 'Web Adaptor' 이전의 인프라 영역이며, AOP는 'Application Layer' 또는 'Web Adaptor'를 타겟으로 합니다.

- **클린 코드 가이드라인**: 본 프로젝트는 메서드 인자 제한(3개 이하), 메서드당 하나의 책임 등 엄격한 스타일을 따르고 있습니다. 비즈니스 로직 내부에 로깅 코드가 섞이는 것은 지양해야 하므로, 두 방식
  모두 횡단 관심사(Cross-cutting Concerns)로 분리하는 것이 적절합니다.

### 3. 최종 권장안: 하이브리드 접근 방식 (MDC Filter + AOP)

프로젝트의 규모 확장성과 유지보수를 고려했을 때, 하나의 방식을 선택하기보다 **MDC Filter를 기반으로 한 공통 추적 환경 위에 AOP로 비즈니스 이벤트를 선별 기록**하는 방식을 권장합니다.

1. **Filter + MDC (TraceID 발급 및 기본 정보)**:

    - 모든 요청에 대해 `traceId`를 발급하고 MDC에 저장합니다.

    - 요청의 시작/종료 시점에 `[Method, URI, Status, Time]` 정도의 요약 정보만 로깅합니다. (Body 로깅 제외)

    - 이는 시스템 전반의 가용성 확인과 장애 발생 시 로그 추적을 위한 기초가 됩니다.


2. **AOP (비즈니스 이벤트 상세 로깅)**:

    - `POST/PUT/DELETE`와 같은 상태 변경을 일으키는 Application Service 또는 Controller 메서드에 적용합니다.

    - `@UserEvent(name="TALK_CREATE")`와 같은 커스텀 어노테이션을 사용하여 로깅 대상을 명시적으로 관리합니다.

    - AOP 내에서 MDC의 정보를 활용하면, 특정 사용자의 행위만을 별도의 '이벤트 로그' 파일이나 DB로 분리하여 수집하기 매우 용이해집니다.

**결론적으로, 단순히 '요청/응답을 그대로 복사'하는 로깅보다는, AOP를 활용하여 '누가 어떤 의미 있는 행동을 했는지'를 기록하는 방식이 SNS 서비스의 성장 단계에서 유지보수와 데이터 활용 측면에서 훨씬
유리합니다.**

## 개발자 추가 검토사항

@UserEvent(name="TALK_CREATE") 와 같은 방식은 충분한 맥락 정보를 담을 수 있어?