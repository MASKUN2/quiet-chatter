# 에이전트 작업 절차

1. 아래 `## 개발자 요구사항` 섹션을 바탕으로 코드 베이스를 검토하고 작업을 준비한다.
2. 만약 마지막 섹션이 `## 개발자 요구사항 수정` 또는 `## 개발자 검토답변` 등 개발자의 섹션이라면 중간을 건너뛰고 해당 부분부터 작업하도록 한다.
3. 개발자의 의사결정이 필요한 내용이 있다면 문의할 내용을 이 파일의 마지막에 `## 에이전트 검토요청`으로 섹션을 추가하고 작업을 종료한다.
4. 작업을 완료한 경우 내용 이 파일의 마지막에 `## 에이전트 작업수행내용 : {yyyy-MM-dd HH : MM}` 섹션을 추가하고 작업한 상세 내용을 작성한다.
5. 모든 문서 업데이트 시 **기존의 요구사항, 계획, 검토 내용 등을 삭제하거나 덮어쓰지 않으며**, 새로운 정보는 항상 파일의 **마지막**에 섹션을 추가하여 기록한다.
6. 작업 계획 수립 시 "A 또는 B"와 같은 모호한 선택지를 배제하고, 가장 적합한 **단일 구현 경로**를 구체적으로 명시한다.
7. 그밖의 일반적인 작업지침은 [ai_agent_guide.md](/docs/guide/ai_agent_guide.md) 을 확인 후 작업한다.

## 개발자 요구사항
- `AuthLoginApiTest`에서 등록된 회원이 아닌 경우 네이버 프로필의 닉네임을 사용하고 있으나, 실제로는 네이버 닉네임을 수집하지 않음.
- 대신 `RandomNickNameSupplierImpl`을 사용하여 닉네임을 생성하도록 변경.
- `MemberService.createNewNaverMember`의 불필요한 null 검사 제거 (무조건 null이 아닌 값을 받도록 함).
- `RandomNickNameSupplier`를 어댑터(`AuthLoginApi` 등)에서 호출 가능한 구조로 리팩토링.
- JSpecify의 `@NullMarked`를 적용하여 명시적인 Null 안전성 확보.

## 에이전트 작업 계획
1. **`RandomNickNameSupplier` 위치 변경**: 
    - `member.application.out`에서 `member.application.in`으로 이동하여 외부 노출 허용.
2. **`MemberService` 및 `MemberRegistrable` 수정**:
    - `createNewNaverMember`에서 `nickname` null 체크 로직 제거.
    - `@NullMarked` 적용 및 파라미터가 non-null임을 보장하도록 수정.
3. **`AuthMemberService` 및 `NaverProfile` 수정**:
    - `NaverProfile` 레코드에서 `nickname` 필드 삭제.
    - `AuthMemberServiceImpl`에서 네이버 프로필 조회 시 닉네임을 수집하지 않도록 수정.
4. **`AuthLoginApi` 수정**:
    - `RandomNickNameSupplier`를 주입받아 미가입 회원 응답 시 임시 닉네임 생성 및 반환.
5. **테스트 코드 수정**:
    - `AuthLoginApiTest` 등 관련 테스트 코드에서 `NaverProfile` 생성 시 닉네임 제거 및 임시 닉네임 검증 로직 반영.
    - `MemberServiceTest` 등에서 null 입력 케이스 제거.

## 에이전트 작업수행내용 : 2026-02-20 19:30

### 1. 닉네임 생성 로직 리팩토링 및 위치 변경
- **`RandomNickNameSupplier` 이동**: `member.application.out`에서 `member.application.in`으로 이동하여 외부 어댑터(`AuthLoginApi`)에서 직접 사용할 수 있도록 공개하였습니다.
- **`RandomNickNameSupplierImpl` 수정**: 인터페이스 위치 변경에 따른 임포트를 업데이트하였습니다.

### 2. 회원 서비스 단순화
- **`MemberService.java`**: 
    - `createNewNaverMember`에서 불필요한 `nickname` null 체크 및 `RandomNickNameSupplier` 의존성을 제거하였습니다.
    - 이제 `MemberService`는 전달받은 닉네임을 신뢰하여 사용합니다.
- **`MemberRegistrable.java` & `MemberQueryable.java`**: 인터페이스에 `@NullMarked`를 적용하여 Null 안전성을 명시하였습니다.

### 3. 네이버 로그인 프로세스 개선
- **`AuthMemberService.java` & `AuthMemberServiceImpl.java`**: 
    - `NaverProfile` 레코드에서 `nickname` 필드를 제거하였습니다.
    - 네이버 프로필 조회 시 더 이상 닉네임을 수집하지 않도록 수정하였습니다.
- **`AuthLoginApi.java`**:
    - `RandomNickNameSupplier`를 주입받아 미가입 사용자의 경우 직접 임시 닉네임을 생성하여 `NaverLoginResponse`에 담아 반환하도록 변경하였습니다.

### 4. Null 안전성 및 코드 스타일 가이드 업데이트
- **`docs/guide/code_style_guide.md`**: JSpecify의 `@NullMarked`를 사용한 Null 안전성 확보 원칙을 가이드에 추가하였습니다.
- **전역적 `@NullMarked` 적용**: `MemberRepository`, `AuthMemberCache`, `AuthMemberService` 등 주요 인터페이스에 `@NullMarked`를 적용하였습니다.

### 5. 테스트 코드 현행화 및 검증
- **`AuthLoginApiTest.java`**: `NaverProfile` 구조 변경을 반영하고, 미가입 시 랜덤 닉네임이 반환되는지 검증하는 Mock 로직을 추가하였습니다.
- **`MemberServiceTest.java`**: `MemberService`에서 닉네임 생성 책임이 제거됨에 따라 관련 테스트 케이스와 Mock을 정리하였습니다.
- **`AuthMemberServiceTest.java`**: `loginWithNaver` 결과에서 닉네임 검증 로직을 제거하였습니다.
- **전체 검증**: 관련 모든 테스트가 성공적으로 통과함을 확인하였습니다.
