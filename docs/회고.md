
이전 회고문서 : [문서](/docs/archive/2025-12-25_quiet-chatter_docs_오픈미션회고.md.pdf)

2025-11-30

### 스프린트 준비

- [ ] 기본적으로 1년이 지난 북톡은 비공개된다.
- [ ] 로그인 기능 추가
- [ ] 나의 서재 추가
- [ ] 영화 검색기능 추가

기술

- [ ] 자바 25, 스프링 부트 4.0 마이그레이션
- [ ] fail2ban 추가
- [ ] 해외 아이피 차단
- [ ] 서버 메모리 여유를 40% 확보
- [ ] 로깅 강화
- [ ] CI/CD스크립트 변경

서비스

- [ ] 서비스 홍보하기

### 2025-11-25 ~ 2025-11-31 Reminiscence

After I submitted the opened-mission assignment, I had rest for about 1 week. I went to my parent's house. There is a dog named Ramen. I washed his hair. I took a walk with him under the daylight. I talked with my parents. I took a rest for 3 days.

I went back home in Seoul. I got enjoyed a game is Baldurs Gate 3 for the rest of the week. I didn't play any games while application for Woa pre-course, so it was fun. The first week passed like this.

### 2025-12-01 ~ 2025-12-05 Reminiscence

If I fail the application, I have to get a job.
So I needed to prepare algorithm test practice because I can be fallen from the application.   
I had stressed about algorithm test practice. I didn't understand why an algorithm test is needed for any application process. This is an age of AI, but algorithm tests are still required to apply for jobs. I felt stressed about this mismatch. After I get a job, I will not need to prepare algorithm test practice anymore. I felt it was counterproductive to prepare for being obsolete after getting a job.

Still, I have to find a job; this is the real world, after all.

It was a hard time getting used to algorithm test practice. But I have not given up yet, I'm slowly getting used to it. I learned BFS, DFS, SORT, STACK, QUEUE ...

It to be continued.

### 2025-12-06 ~ 2025-12-14 Reminiscence

Sometimes, I would get stuck on a single algorithm problem all day long. I avoided reading the solution to improve my thinking skills. It would make me thoughtful, but it was not productive. I've figured out spending time too much on a single problem is bad for me mentally. I decided to set a time limit for each problem. If the time runs out, I read the solution.

### flyway 적용한 이유 : DB스키마의 통제권을 개발자가 가지게 하기 위해

이전까지는 빠른 개발을 위해서 JPA 하이버네이트의 Auto DDL 기능을 사용했다. 그러나 앞으로 엔티티의 속성을 추가하게 되는 일이 빈번하게 이뤄질 것이므로 좀더 운영레벨에 가깝게 데이터베이스 스키마를 핸들링하고 싶었다.

실제로 Talk 엔티티에 삭제되었는지 여부를 기록하기 위한 `isHidden`이란 이름의 플래그 속성을 두려고 했다. 이를 JPA 하이버네이트의 Auto DDL에 맡기자니 이미 존재하고 있는 레코드에 기본값이 반영될지 예측할 수 없었기에 flyway를 적용하여 이를 마이그레이션하기로 했다.

### 서버 인스턴스의 메모리 확보하기 : swap 메모리와 컨테이너 메모리 설정

나는 Talk의 TTL에 따른 자동 숨김을 처리할 배치서버를 API 서버와 분리할지를 고민하고 있었다. 라이트서버 인스턴스를 보니 769/914MB 의 메모리를 사용하고 있었고 적어도 스프링 서버 하나가 차지하는 메모리가 400MB이기 때문에 새로운 서버를 추가하기는 어려울 것으로 판단했다. 인스턴스를 확장하는 선택지도 물론 좋지만 최적화를 미리 생각하는 차원에서 서버의 가용한 메모리를 최대한 확보하기로 했다.

우선 현재 메모리 확보 상태도 위태하므로 gemini의 힘을 빌려 2GB의 Swap 메모리를 추가했고 가용 메모리가 10% 수준에 근접했을 때 스왑메모리를 사용하도록 서버에 설정했다. 서버가 복귀되어도 해당 설정이 적용되도록 했다.

또한 docker compose 설정파일에서 각 컨테이너별 최대 점유가능한 메모리를 분배했다. 총합이 700MB이 넘지 않도록 했다. 스프링 서버가 대부분 차지하므로 스프링 JVM 설정을 좀더 마른 수건을 쥐어짜야했다. 힙을 256MB로 줄이고 스레드 사이즈를 512KB로 줄였다.

아래는 설정을 마친 결과 값이다.

```text
ubuntu@ip-172-*:~$ free -h

               total        used        free      shared  buff/cache   available

Mem:           914Mi       685Mi        91Mi       8.4Mi       299Mi       228Mi

Swap:          2.0Gi        99Mi       1.9Gi


CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT   MEM %     NET I/O           BLOCK I/O         PIDS 
b80a37c57657   quiet-chatter   0.18%     299.6MiB / 450MiB   66.59%    29.1kB / 27.9kB   81.1MB / 57.3kB   23 
f5df89958497   nginx           0.00%     2.008MiB / 64MiB    3.14%     19.9MB / 20MB     9.33MB / 1.94MB   3 
ea1c4ce953ec   postgres        0.00%     31.57MiB / 100MiB   31.57%    129kB / 242kB     34MB / 6.15MB     19 
18b9c45f457c   watchtower      0.00%     10.85MiB / 32MiB    33.90%    653kB / 234kB     13.6MB / 733kB    8 
```

used 메모리는 769Mi -> 685Mi 로 감소했고 available 은 144Mi-> 299Mi 로 증가했다. 이 상태로 배치용 서버 하나를 새로 추가하는 것도 물론 가능하겠지만 향후 DB에 데이터가 많이 적제되면 캐시를 늘릴 필요가 있기에 이정도 가용 메모리는 여전히 금방 소모될 수 있으므로 배치서버를 추가하지 않는 것으로 결정했다. 대신 기존 API 서버에서 향후 쉽게 분리가 될 수 있도록 의존성을 최소화 하여 개발하는 것이 좋겠다고 판단했다. 


### 자바에서 코틀린으로 프로젝트 언어를 마이그레이션 하는 이유

여러 대기업들의 백엔드 기술 언어가 자바에서 코틀린으로 전환되는 것 같다. 코틀린에서 다시 자바로 돌아가는 경우는 적은 것 같다. 나또한 코틀린의 장점을 알고 있기에 코틀린을 배우는 게 좋다고 생각했다. 

### DB 접근 기술을 Spring Data JPA + JdbcTemplate으로 유지하는 이유 ; Spring Data MongoDB와 Spring Data JDBC에 대한 생각

Spring Data MongoDB와 Spring Data JDBC 은 Spring Data JPA에 비교해서 둘다 무척 매력적이다. 

다만 NoSQL DB를 아직까지 메인 애플리케이션의 데이터베이스로 사용하는 기업은 소수인 것 같고 대부분 RDB에서 성장함에 따라 필요에 따라 도입을 하는 것으로 이해했다. 

Spring Data JDBC는 무척 직관적이고 쉽고 빠르지만 여전히 메이저 기술은 아니기에 조금 꺼려진다.

### Kotlin JDSL에 대하여 

JDSL은 Kotlin으로 사용가능한 
